module.exports=[88584,a=>{"use strict";a.s(["default",()=>i],88584);var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(83069),f=a.i(35231),g=a.i(5467);function h({sequence:a,index:d,blogContents:e,blogMedia:f,onUpdate:h,onRemove:i,onMove:j,disabled:k=!1}){let[l,m]=(0,c.useState)(!1),n=a.type;return(0,b.jsxs)("div",{draggable:!k,onDragStart:b=>{k||(m(!0),b.dataTransfer.effectAllowed="move",b.dataTransfer.setData("text/plain",d.toString()),b.dataTransfer.setData("application/json",JSON.stringify({index:d,sequenceId:a.id})))},onDragEnd:()=>{m(!1)},onDragOver:a=>{a.preventDefault(),a.dataTransfer.dropEffect="move"},onDrop:a=>{if(a.preventDefault(),!k)try{let b=parseInt(a.dataTransfer.getData("text/plain"));isNaN(b)||b===d||j(b,d)}catch(a){console.error("Error handling drop:",a)}},className:`p-4 border-2 border-dashed rounded-lg transition-all duration-200 ${l?"border-blue-500 bg-blue-50 shadow-lg transform rotate-2 scale-105":"border-gray-300 hover:border-gray-400 hover:shadow-md"} ${k?"opacity-50 cursor-not-allowed":"cursor-move hover:bg-gray-50"}`,children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,b.jsx)("div",{className:"w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center text-sm font-medium text-gray-600",children:a.sequence}),(0,b.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"content"===n?"Content":"Media"})]}),!k&&(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)("div",{className:"text-gray-400 text-xs",children:"Drag to reorder"}),(0,b.jsx)("div",{className:"text-gray-400",children:"â‹®â‹®"})]}),(0,b.jsx)("button",{type:"button",onClick:()=>i(a.id),className:"text-red-500 hover:text-red-700 text-sm",disabled:k,children:"Remove"})]}),"content"===n?(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Content"}),(0,b.jsx)(g.default,{options:e.map(a=>({value:a.id,label:a.name})),value:a.blogContentId||"",onChange:b=>{h(a.id,{blogContentId:b||void 0,type:"content"})},placeholder:"Choose content...",disabled:k,className:"w-full"}),a.blogContentId&&(0,b.jsx)("div",{className:"mt-2 p-2 bg-gray-50 rounded text-sm text-gray-600",children:e.find(b=>b.id===a.blogContentId)?.name})]}):(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Media"}),(0,b.jsxs)("select",{value:a.blogMediaId||"",onChange:b=>{var c;return c=b.target.value,void h(a.id,{blogMediaId:c,type:"media"})},className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",disabled:k,children:[(0,b.jsx)("option",{value:"",children:"Choose media..."}),f.map(a=>(0,b.jsxs)("option",{value:a.id,children:[a.name," (",a.mediaType,")"]},a.id))]}),a.blogMediaId&&(0,b.jsx)("div",{className:"mt-2",children:(()=>{let c=f.find(b=>b.id===a.blogMediaId);return c?(0,b.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4 bg-white",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,b.jsx)("h4",{className:"font-medium text-gray-900",children:c.name}),(0,b.jsx)("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded",children:c.mediaType})]}),(0,b.jsxs)("div",{className:"mt-3",children:["IMAGE"===c.mediaType?(0,b.jsx)("img",{src:c.mediaUrl,alt:c.name,className:"max-w-full max-h-48 object-contain rounded border",onError:a=>{a.currentTarget.style.display="none",a.currentTarget.nextElementSibling?.classList.remove("hidden")}}):"VIDEO"===c.mediaType?(0,b.jsx)("video",{src:c.mediaUrl,controls:!0,className:"max-w-full max-h-48 rounded border",onError:a=>{a.currentTarget.style.display="none",a.currentTarget.nextElementSibling?.classList.remove("hidden")}}):"AUDIO"===c.mediaType?(0,b.jsx)("audio",{src:c.mediaUrl,controls:!0,className:"w-full",onError:a=>{a.currentTarget.style.display="none",a.currentTarget.nextElementSibling?.classList.remove("hidden")}}):(0,b.jsx)("div",{className:"flex items-center justify-center p-8 bg-gray-50 rounded border",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"text-4xl mb-2",children:"ðŸ“„"}),(0,b.jsxs)("p",{className:"text-sm text-gray-600",children:[c.mediaType," File"]}),(0,b.jsx)("a",{href:c.mediaUrl,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 text-sm mt-1 inline-block",children:"View File"})]})}),(0,b.jsx)("div",{className:"hidden items-center justify-center p-8 bg-gray-50 rounded border",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"text-4xl mb-2",children:"âš ï¸"}),(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"Media preview unavailable"}),(0,b.jsx)("a",{href:c.mediaUrl,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 text-sm mt-1 inline-block",children:"Open in new tab"})]})})]}),c.description&&(0,b.jsx)("div",{className:"mt-3 text-center",children:(0,b.jsx)("p",{className:"text-sm text-gray-500 italic",children:c.description})}),(0,b.jsx)("div",{className:"mt-2 text-xs text-gray-500 break-all",children:c.mediaUrl})]}):null})()})]})]})}function i({initialData:a,isEditing:g=!1}){let[i,j]=(0,c.useState)(a?.title||""),[k,l]=(0,c.useState)(a?.slug||""),[m,n]=(0,c.useState)(a?.tags||[]),[o,p]=(0,c.useState)(a?.status||"DRAFT"),[q,r]=(0,c.useState)(a?.readingTime||5),[s,t]=(0,c.useState)(()=>a?.categories?.map(a=>a.id)||[]),[u,v]=(0,c.useState)(a?.sequences||[]),[w,x]=(0,c.useState)(""),[y,z]=(0,c.useState)(!1),[A,B]=(0,c.useState)(""),[C,D]=(0,c.useState)([]),[E,F]=(0,c.useState)([]),[G,H]=(0,c.useState)([]),[I,J]=(0,c.useState)(!0),[K,L]=(0,c.useState)(50),M=(0,d.useRouter)(),{user:N}=(0,e.useRole)();(0,c.useEffect)(()=>{O()},[]),(0,c.useEffect)(()=>{g&&a?.sequences&&E.length>0&&G.length>0&&v(a.sequences.map(a=>{let b={...a};if(a.blogContentId){let c=E.find(b=>b.id===a.blogContentId);c&&(b.blogContent=c,b.type="content")}if(a.blogMediaId){let c=G.find(b=>b.id===a.blogMediaId);c&&(b.blogMedia=c,b.type="media")}return b}))},[g,a?.sequences,E,G]),(0,c.useEffect)(()=>{g&&a?.categories&&C.length>0&&t(a.categories.map(a=>a.id))},[g,a?.categories,C]);let O=async()=>{try{let[a,b,c]=await Promise.all([fetch("/api/categories"),fetch("/api/blog-content"),fetch("/api/blog-media")]),[d,e,f]=await Promise.all([a.json(),b.json(),c.json()]);D(d.categories||[]),F(e.blogContents||[]),H(f.data||[])}catch(a){console.error("Error fetching data:",a)}finally{J(!1)}},P=a=>a.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim(),Q=(a,b)=>{v(u.map(c=>{if(c.id===a){let a={...c,...b};if("content"===b.type?(a.blogMediaId=void 0,a.blogMedia=void 0):"media"===b.type&&(a.blogContentId=void 0,a.blogContent=void 0),b.blogContentId&&"content"===b.type){let c=E.find(a=>a.id===b.blogContentId);c&&(a.blogContent=c)}if(b.blogMediaId&&"media"===b.type){let c=G.find(a=>a.id===b.blogMediaId);c&&(a.blogMedia=c)}return a}return c}))},R=a=>{v(u.filter(b=>b.id!==a).sort((a,b)=>a.sequence-b.sequence).map((a,b)=>({...a,sequence:b+1})))},S=(a,b)=>{if(a===b)return;if(a<0||a>=u.length||b<0||b>=u.length)return void console.error("Invalid drag indices:",{dragIndex:a,hoverIndex:b,length:u.length});let c=u[a],d=[...u];d.splice(a,1),d.splice(b,0,c),v(d.map((a,b)=>({...a,sequence:b+1})))},T=async b=>{b.preventDefault(),z(!0),B("");try{let b=g?`/api/blogs/${a?.id}`:"/api/blogs",c=g?"PUT":"POST",d=await fetch(b,{method:c,headers:{"Content-Type":"application/json"},body:JSON.stringify({title:i,slug:k,tags:m,status:o,readingTime:q,authorId:N?.id,categoryIds:s,sequences:u.map(a=>({sequence:a.sequence,type:a.type,blogContentId:a.blogContentId,blogMediaId:a.blogMediaId}))})});if(!d.ok){let a=await d.json();throw Error(a.error||"Failed to save blog")}await d.json(),M.push("/admin/blogs")}catch(a){console.error("Error saving blog:",a),B(a instanceof Error?a.message:"Failed to save blog")}finally{z(!1)}};return I?(0,b.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),(0,b.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading..."})]})}):g&&a?.sequences&&0===u.length?(0,b.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),(0,b.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading blog sequences..."})]})}):(0,b.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,b.jsxs)("div",{className:"flex h-screen",children:[(0,b.jsx)("div",{className:"bg-white shadow-lg overflow-y-auto",style:{width:`${100-K}%`},children:(0,b.jsxs)("div",{className:"p-6",children:[(0,b.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:g?"Edit Blog":"Create New Blog"}),(0,b.jsxs)("form",{onSubmit:T,className:"space-y-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700 mb-2",children:"Title *"}),(0,b.jsx)("input",{type:"text",id:"title",value:i,onChange:b=>{let c=b.target.value;j(c),g&&k!==P(a?.title||"")||l(P(c))},className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter blog title",required:!0,disabled:y})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{htmlFor:"slug",className:"block text-sm font-medium text-gray-700 mb-2",children:"Slug *"}),(0,b.jsx)("input",{type:"text",id:"slug",value:k,onChange:a=>l(a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"blog-slug",required:!0,disabled:y})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tags"}),(0,b.jsx)("div",{className:"flex flex-wrap gap-2 mb-2",children:m.map((a,c)=>(0,b.jsxs)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm bg-blue-100 text-blue-800",children:[a,(0,b.jsx)("button",{type:"button",onClick:()=>{n(m.filter(b=>b!==a))},className:"ml-2 text-blue-600 hover:text-blue-800",children:"Ã—"})]},c))}),(0,b.jsx)("input",{type:"text",value:w,onChange:a=>x(a.target.value),onKeyDown:a=>{"Enter"===a.key&&w.trim()&&(a.preventDefault(),m.includes(w.trim())||n([...m,w.trim()]),x(""))},className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Add tags (press Enter to add)",disabled:y})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),(0,b.jsxs)("select",{id:"status",value:o,onChange:a=>p(a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",disabled:y,children:[(0,b.jsx)("option",{value:"DRAFT",children:"Draft"}),(0,b.jsx)("option",{value:"PUBLISHED",children:"Published"}),(0,b.jsx)("option",{value:"ARCHIVED",children:"Archived"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{htmlFor:"readingTime",className:"block text-sm font-medium text-gray-700 mb-2",children:"Reading Time (minutes)"}),(0,b.jsx)("input",{type:"number",id:"readingTime",min:"1",max:"120",value:q,onChange:a=>r(parseInt(a.target.value)||5),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"5",disabled:y}),(0,b.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Estimated reading time in minutes (1-120)"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Categories"}),(0,b.jsx)("div",{className:"space-y-2 max-h-32 overflow-y-auto border border-gray-300 rounded-md p-2",children:C.map(a=>{let c=s.includes(a.id);return(0,b.jsxs)("label",{className:"flex items-center",children:[(0,b.jsx)("input",{type:"checkbox",checked:c,onChange:b=>{b.target.checked?t([...s,a.id]):t(s.filter(b=>b!==a.id))},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500",disabled:y}),(0,b.jsx)("span",{className:"ml-2 text-sm text-gray-700",children:a.name})]},a.id)})})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Content Sequence"}),(0,b.jsxs)("div",{className:"flex space-x-2",children:[(0,b.jsx)("button",{type:"button",onClick:()=>{let a=Math.max(...u.map(a=>a.sequence),0)+1;v([...u,{id:`temp-${Date.now()}`,sequence:a,type:"content",blogContentId:void 0}])},className:"px-3 py-1 text-sm bg-green-600 text-white rounded hover:bg-green-700",disabled:y,children:"+ Add Content"}),(0,b.jsx)("button",{type:"button",onClick:()=>{let a=Math.max(...u.map(a=>a.sequence),0)+1;v([...u,{id:`temp-${Date.now()}`,sequence:a,type:"media",blogMediaId:void 0}])},className:"px-3 py-1 text-sm bg-purple-600 text-white rounded hover:bg-purple-700",disabled:y,children:"+ Add Media"})]})]}),(0,b.jsx)("div",{className:"space-y-3",children:u.sort((a,b)=>a.sequence-b.sequence).map((a,c)=>(0,b.jsx)(h,{sequence:a,index:c,blogContents:E,blogMedia:G,onUpdate:Q,onRemove:R,onMove:S,disabled:y},a.id))})]}),A&&(0,b.jsx)("div",{className:"text-red-600 text-sm bg-red-50 p-3 rounded-md",children:A}),(0,b.jsxs)("div",{className:"flex space-x-3",children:[(0,b.jsx)("button",{type:"submit",disabled:y||!i.trim()||!k.trim(),className:"flex-1 bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:y?"Saving...":g?"Update Blog":"Create Blog"}),(0,b.jsx)("button",{type:"button",onClick:()=>M.push("/admin/blogs"),className:"flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-md hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition-colors",disabled:y,children:"Cancel"})]})]})]})}),(0,b.jsx)("div",{className:"w-2 bg-gray-300 hover:bg-gray-400 cursor-col-resize flex items-center justify-center",onMouseDown:a=>{let b=a.clientX,c=a=>{L(Math.max(20,Math.min(80,K-(a.clientX-b)/window.innerWidth*100)))},d=()=>{document.removeEventListener("mousemove",c),document.removeEventListener("mouseup",d)};document.addEventListener("mousemove",c),document.addEventListener("mouseup",d)},children:(0,b.jsx)("div",{className:"w-1 h-8 bg-gray-500 rounded"})}),(0,b.jsx)("div",{className:"bg-gray-100 overflow-y-auto",style:{width:`${K}%`},children:(0,b.jsxs)("div",{className:"p-6",children:[(0,b.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Preview"}),(0,b.jsx)(f.default,{title:i,tags:m,categories:C.filter(a=>s.includes(a.id)),sequences:u})]})})]})})}}];

//# sourceMappingURL=src_components_BlogForm_tsx_77e31685._.js.map